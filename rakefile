task :default => "test"


namespace "lexer" do
    file "lib/lexer/lexer.rb" => "lib/lexer/lexer.rex" do
        sh "rex --output-file lib/lexer/lexer.rb lib/lexer/lexer.rex"
    end
    task "test" => "lib/lexer/lexer.rb" do
        sh "rspec --color test/lexer_test.rb"
        sh "rspec --color test/lexer_quiet_test.rb"
        sh "rspec --color test/lexer_incorrect_test.rb"
    end
    task "clean" do
        rm "lib/lexer/lexer.rb"
    end
end

namespace "parser" do
    file "lib/parser/parser.rb" => ["lib/lexer/lexer.rb", "lib/parser/grammar.y"] do
        sh "racc --verbose --output-file=lib/parser/parser.rb lib/parser/grammar.y"
    end
    task "test" => "lib/parser/parser.rb" do
        sh "rspec --color test/parser_test.rb"
    end
    task "clean" do
        rm "lib/parser/parser.rb"
    end
end

task :test => ["lexer:test", "parser:test"]
task :clean => ["lexer:clean", "parser:clean"]


